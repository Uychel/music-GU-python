<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Qu·∫£n tr·ªã - Pet's Home</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style> 
    /* T√îNG M√ÄU T∆Ø∆†I S√ÅNG & S·∫†CH */
    :root {
      --primary-color: #00b894; /* Xanh Ng·ªçc */
      --secondary-color: #ffc34d; /* V√†ng N·∫Øng */
      --text-color: #2d3436;
      --bg-light: #f1f8ff; 
    }
    body { background: #f7f9fb; color: var(--text-color); }
    .navbar { 
      background: var(--bg-light); 
      box-shadow: 0 2px 4px rgba(0,0,0,.05);
      border-bottom: 3px solid var(--primary-color);
    }
    .navbar-brand, .nav-link { color: var(--text-color) !important; }
    
    /* TI√äU ƒê·ªÄ TRANG */
    .page-title { 
        color: var(--primary-color); 
        font-weight: 700; 
        border-bottom: 3px solid var(--primary-color);
        padding-bottom: 10px;
        margin-bottom: 30px !important;
        display: inline-block;
    }
    
    /* STYLE RI√äNG CHO ADMIN CARDS */
    .admin-card { 
        background-color: white;
        border-radius: 12px; 
        padding: 25px; 
        box-shadow: 0 6px 20px rgba(0,0,0,0.08); 
        margin-bottom: 35px; /* TƒÉng kho·∫£ng c√°ch gi·ªØa c√°c kh·ªëi */
    }
    .admin-card h5 { 
        color: var(--text-color); 
        font-weight: 600;
        border-bottom: 1px dashed #ddd; 
        padding-bottom: 10px; 
        margin-bottom: 20px; 
    }
    
    /* STYLE INPUT/BUTTON */
    .form-control, .form-select { border-radius: 6px; border-color: #ddd; }
    .btn-action { background: var(--primary-color); color: white; }
    
    /* STYLE B·∫¢NG PH√ÇN QUY·ªÄN */
    .table-warning { background-color: var(--secondary-color) !important; color: var(--text-color); }
    .alert-warning { background-color: #ffeaa7; border-color: #fdcb6e; color: var(--text-color); }

    /* FOOTER */
    footer { 
        background: var(--secondary-color); 
        color: var(--text-color);
    }
  </style>
</head>
<body>
<nav class="navbar navbar-expand-lg">
  <div class="container">
    <a class="navbar-brand fw-bold" href="index.html">üêæ Pet's Home</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#menu">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="menu">
      <ul class="navbar-nav ms-auto align-items-center">
        <li class="nav-item"><a class="nav-link" href="index.html">Trang ch·ªß</a></li>
        <li class="nav-item"><a class="nav-link" href="sanpham.html">S·∫£n ph·∫©m</a></li>
        <li class="nav-item"><a class="nav-link" href="giohang.html">Gi·ªè h√†ng</a></li>
        <li class="nav-item"><a class="nav-link" href="donhang.html">ƒê∆°n h√†ng</a></li>

        <li class="nav-item d-none" id="navCustomers"><a class="nav-link" href="khachhang.html">Kh√°ch h√†ng</a></li>
        <li class="nav-item d-none" id="navAdmin"><a class="nav-link fw-bold" href="quantri.html">Qu·∫£n tr·ªã</a></li>

        <li class="nav-item" id="navLogin"><a class="nav-link" href="index.html">ƒêƒÉng nh·∫≠p</a></li>

        <li class="nav-item dropdown d-none" id="navUser">
          <a class="nav-link dropdown-toggle" href="#" id="navUserName" role="button" data-bs-toggle="dropdown">T√†i kho·∫£n</a>
          <ul class="dropdown-menu dropdown-menu-end">
            <li><a class="dropdown-item" href="donhang.html">ƒê∆°n h√†ng c·ªßa t√¥i</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item text-danger" href="#" onclick="PetShop.logout(); location.href='index.html';">ƒêƒÉng xu·∫•t</a></li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
</nav>



<div class="container my-5">
  <h3 class="page-title">B·∫£ng qu·∫£n tr·ªã (Admin)</h3>

  <div class="alert alert-warning" id="guard" style="display:none">
    B·∫°n kh√¥ng c√≥ quy·ªÅn truy c·∫≠p trang n√†y. Trang qu·∫£n tr·ªã ch·ªâ d√†nh cho <strong>Qu·∫£n tr·ªã vi√™n (Admin)</strong>.
  </div>

  <div id="adminOnly" style="display:none">

    <div id="adminWrap" class="admin-card">
      <h5>Qu·∫£n l√Ω S·∫£n ph·∫©m</h5>
      <div class="row g-2">
        <div class="col-md-2"><input id="pid" class="form-control form-control-sm" placeholder="M√£ (Pxxx)"></div>
        <div class="col-md-3"><input id="pname" class="form-control form-control-sm" placeholder="T√™n s·∫£n ph·∫©m"></div>
        <div class="col-md-2"><input id="pprice" type="number" class="form-control form-control-sm" placeholder="Gi√° b√°n"></div>
        <div class="col-md-2"><input id="pstock" type="number" class="form-control form-control-sm" placeholder="T·ªìn"></div>
        <div class="col-md-3"><input id="pimg" class="form-control form-control-sm" placeholder="ƒê∆∞·ªùng d·∫´n ·∫£nh"></div>
        <div class="col-12 d-flex gap-3 mt-3">
          <button class="btn btn-sm btn-action" onclick="saveProduct()">L∆∞u/Th√™m</button>
          <button class="btn btn-sm btn-danger" onclick="deleteProduct()">X√≥a</button>
        </div>
      </div>
    </div>

    <div class="admin-card">
      <h5>Qu·∫£n l√Ω Kho</h5>
      <div class="row g-2">
        <div class="col-md-2"><input id="sid" class="form-control form-control-sm" placeholder="M√£ SP"></div>
        <div class="col-md-2"><input id="sq" type="number" class="form-control form-control-sm" placeholder="S·ªë l∆∞·ª£ng"></div>
        <div class="col-md-4"><input id="snote" class="form-control form-control-sm" placeholder="Ghi ch√∫"></div>
        <div class="col-md-4 d-flex gap-3">
          <button class="btn btn-sm btn-success" onclick="PetShop.importStock(getVal('sid'), getNum('sq'), getVal('snote'))">Nh·∫≠p</button>
          <button class="btn btn-sm btn-warning text-dark" onclick="PetShop.exportStock(getVal('sid'), getNum('sq'), getVal('snote'))">Xu·∫•t</button>
          <button class="btn btn-sm btn-danger" onclick="PetShop.destroyStock(getVal('sid'), getNum('sq'), getVal('snote'))">H·ªßy</button>
        </div>
      </div>
    </div>

    <div class="admin-card">
      <h5>B√°o c√°o nhanh & C·∫£nh b√°o</h5>
      <ul id="lowStock" class="mb-2 list-unstyled"></ul>
      <div class="mt-1 fs-5">Doanh thu: <strong id="rev" style="color: var(--primary-color);">0ƒë</strong></div>
    </div>

    <div class="admin-card">
      <h5>Ph√¢n quy·ªÅn ng∆∞·ªùi d√πng</h5>
      <div class="table-responsive">
        <table class="table table-bordered align-middle text-center">
          <thead class="table-warning">
            <tr>
              <th>T√™n</th>
              <th>Email</th>
              <th>Vai tr√≤</th>
              <th>H√†nh ƒë·ªông</th>
            </tr>
          </thead>
          <tbody id="userBody"></tbody>
        </table>
      </div>
    </div>

  </div></div>

<footer class="text-center py-3 mt-5" style="background: var(--secondary-color); color: var(--text-color);">
    ¬© 2025 Pet's Home. All rights reserved üêæ
</footer>

<script src="app.js"></script>
<script>
  // ===== Guard trang: ch·ªâ Admin m·ªõi ƒë∆∞·ª£c v√†o =====
  const u = PetShop.getCurrentUser?.();
  if (!PetShop.isAdmin()) {
    document.getElementById('guard').style.display = 'block';
    document.getElementById('adminOnly').style.display = 'none';
  } else {
    document.getElementById('guard').style.display = 'none';
    document.getElementById('adminOnly').style.display = 'block';
  }

  // ===== Helpers l·∫•y value/number t·ª´ input =====
  const getVal = id => (document.getElementById(id)?.value || "").trim();
  const getNum = id => parseInt(document.getElementById(id)?.value || "0", 10);

  // ===== CRUD S·∫£n ph·∫©m (Admin) =====
  function saveProduct(){
    if (!PetShop.isAdmin()) return alert("B·∫°n kh√¥ng c√≥ quy·ªÅn.");
    const id = getVal('pid');
    const name = getVal('pname');
    const price = getNum('pprice');
    const stock = getNum('pstock');
    const img = getVal('pimg');
    if(!id || !name) return alert("Vui l√≤ng nh·∫≠p M√£ & T√™n s·∫£n ph·∫©m!");

    const products = getLS("products", []);
    const p = products.find(x=>x.id===id);
    if (p) {
      p.name = name; p.price = price; p.stock = stock; p.img = img || p.img;
    } else {
      products.push({
        id, name,
        brand:"", category:"Ph·ª• ki·ªán", target:"Ch√≥", unit:"c√°i",
        price, salePrice:null, stock, img, description:"", expiry:""
      });
    }
    setLS("products", products);
    alert("ƒê√£ l∆∞u s·∫£n ph·∫©m.");
  }

  function deleteProduct(){
    if (!PetShop.isAdmin()) return alert("B·∫°n kh√¥ng c√≥ quy·ªÅn.");
    const id = getVal('pid'); if(!id) return alert("Nh·∫≠p M√£ s·∫£n ph·∫©m ƒë·ªÉ x√≥a!");
    let products = getLS("products", []);
    const before = products.length;
    products = products.filter(x=>x.id!==id);
    setLS("products", products);
    alert(before===products.length ? "Kh√¥ng t√¨m th·∫•y m√£ s·∫£n ph·∫©m." : "ƒê√£ x√≥a s·∫£n ph·∫©m.");
  }

  // ===== B√°o c√°o nhanh =====
  function renderReport(){
    const r = PetShop.computeReports();
    document.getElementById('rev').textContent = PetShop.fmtVND(r.revenue);
    document.getElementById('lowStock').innerHTML = r.stockLow.length
      ? r.stockLow.map(x=>`<li><span class="badge bg-danger me-2">!</span>${x.id} - ${x.name}: ${x.stock}</li>`).join("")
      : "<li>Kh√¥ng c√≥ c·∫£nh b√°o t·ªìn th·∫•p</li>";
  }

  // ===== Ph√¢n quy·ªÅn ng∆∞·ªùi d√πng (Admin) =====
  function renderUsers(){
    if (!PetShop.isAdmin()) return;
    const users = getLS("registeredUsers", []);
    document.getElementById("userBody").innerHTML = users.map((u,i)=>`
      <tr>
        <td>${u.name}</td>
        <td>${u.email}</td>
        <td>
          <select class="form-select form-select-sm" id="role_${i}">
            <option ${u.role==='customer'?'selected':''} value="customer">Kh√°ch h√†ng</option>
            <option ${u.role==='staff'?'selected':''} value="staff">Nh√¢n vi√™n b√°n h√†ng</option>
            <option ${u.role==='admin'?'selected':''} value="admin">Qu·∫£n tr·ªã</option>
          </select>
        </td>
        <td><button class="btn btn-sm btn-action" onclick="saveRole(${i})" style="background:var(--primary-color); color:white;">L∆∞u</button></td>
      </tr>
    `).join("") || `<tr><td colspan="4"><div class="alert alert-light my-3">Ch∆∞a c√≥ ng∆∞·ªùi d√πng.</div></td></tr>`;
  }

  function saveRole(idx){
    if (!PetShop.isAdmin()) return alert("B·∫°n kh√¥ng c√≥ quy·ªÅn.");
    const users = getLS("registeredUsers", []);
    const sel = document.getElementById("role_"+idx);
    users[idx].role = sel.value;
    setLS("registeredUsers", users);
    alert("ƒê√£ c·∫≠p nh·∫≠t vai tr√≤ ng∆∞·ªùi d√πng.");
  }

  // ===== Kh·ªüi t·∫°o khi v√†o trang =====
  if (PetShop.isAdmin()) {
    renderReport();
    renderUsers();
  }
</script>
</body>
</html>