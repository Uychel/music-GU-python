<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Gi·ªè h√†ng - Pet's Home</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background:#fff8f0; }
    .navbar { background:#8ad1eda9; }
    .cart-table th, .cart-table td { vertical-align: middle; }
    .cart-badge { position:relative; }
    .cart-badge .js-cart-badge { position:absolute; top:-8px; right:-10px; background:#dc3545; color:#fff; border-radius:50%; font-size:12px; padding:2px 6px; display:none; }
  </style>
</head>
<body>
<nav class="navbar navbar-expand-lg">
  <div class="container">
    <a class="navbar-brand" href="index.html">üêæ Pet's Home</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#menu">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="menu">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="index.html">Trang ch·ªß</a></li>
        <li class="nav-item"><a class="nav-link" href="sanpham.html">S·∫£n ph·∫©m</a></li>
        <li class="nav-item"><a class="nav-link" href="giohang.html">Gi·ªè h√†ng</a></li>
        <li class="nav-item"><a class="nav-link" href="donhang.html">ƒê∆°n h√†ng</a></li>

        <!-- Link ri√™ng cho staff/admin -->
        <li class="nav-item d-none" id="navCustomers"><a class="nav-link" href="khachhang.html">Kh√°ch h√†ng</a></li>
        <li class="nav-item d-none" id="navAdmin"><a class="nav-link" href="quantri.html">Qu·∫£n tr·ªã</a></li>

        <!-- ƒêƒÉng nh·∫≠p -->
        <li class="nav-item" id="navLogin"><a class="nav-link" href="dangnhap.html">ƒêƒÉng nh·∫≠p</a></li>

        <!-- Menu ng∆∞·ªùi d√πng sau khi login -->
        <li class="nav-item dropdown d-none" id="navUser">
          <a class="nav-link dropdown-toggle" href="#" id="navUserName" role="button" data-bs-toggle="dropdown">T√†i kho·∫£n</a>
          <ul class="dropdown-menu dropdown-menu-end">
            <li><a class="dropdown-item" href="donhang.html">ƒê∆°n h√†ng c·ªßa t√¥i</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item text-danger" href="#" onclick="PetShop.logout(); location.href='index.html';">ƒêƒÉng xu·∫•t</a></li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
</nav>



<div class="container my-5">
  <h3 class="text-center mb-4">üõçÔ∏è Gi·ªè h√†ng c·ªßa b·∫°n</h3>
  <table class="table cart-table table-bordered text-center align-middle">
    <thead class="table-info">
      <tr>
        <th>H√¨nh ·∫£nh</th>
        <th>S·∫£n ph·∫©m</th>
        <th>Gi√°</th>
        <th style="width:130px">S·ªë l∆∞·ª£ng</th>
        <th>Th√†nh ti·ªÅn</th>
        <th>H√†nh ƒë·ªông</th>
      </tr>
    </thead>
    <tbody id="cartBody"></tbody>
  </table>

  <div class="row">
    <div class="col-md-6">
      <div class="card p-3">
        <h6 class="mb-3">Th√¥ng tin kh√°ch (t√πy ch·ªçn)</h6>
        <div class="row g-2">
          <div class="col-md-6"><input id="cName" class="form-control" placeholder="H·ªç t√™n"></div>
          <div class="col-md-6"><input id="cPhone" class="form-control" placeholder="SƒêT"></div>
          <div class="col-12"><input id="cAddr" class="form-control" placeholder="ƒê·ªãa ch·ªâ giao h√†ng"></div>
        </div>
      </div>
    </div>
    <div class="col-md-6 text-end">
      <h5 class="mt-3">T·ªïng c·ªông: <span id="cartTotal" class="text-success fw-bold">0ƒë</span></h5>
      <button class="btn btn-success mt-2" onclick="onCheckout()">Thanh to√°n</button>
    </div>
  </div>
</div>

<footer class="text-center py-3 bg-warning text-white">
  ¬© 2025 Pet's Home. All rights reserved üêæ
</footer>

<script src="app.js"></script>
<script>
  function renderCart() {
    const cartBody = document.getElementById("cartBody");
    const cart = getCart();
    const products = getLS("products",[]);
    cartBody.innerHTML = "";
    if (!cart.length) {
      cartBody.innerHTML = `<tr><td colspan="6">Gi·ªè h√†ng tr·ªëng!</td></tr>`;
      document.getElementById("cartTotal").innerText = "0ƒë";
      return;
    }
    let total = 0;
    cart.forEach((item, idx)=>{
      const p = products.find(pp=>pp.id===item.id);
      const maxQty = p? p.stock + item.quantity : item.quantity; // cho ph√©p gi·∫£m v·ªÅ kho hi·ªán c√≥
      const itemTotal = item.price * item.quantity;
      total += itemTotal;
      cartBody.innerHTML += `
        <tr>
          <td><img src="${item.img}" width="70" alt=""></td>
          <td>${item.name}<div class="small text-muted">M√£: ${item.id}</div></td>
          <td>${fmtVND(item.price)}</td>
          <td>
            <input type="number" class="form-control text-center" min="1" max="${maxQty}" value="${item.quantity}"
              onchange="updateQuantity(${idx}, this.value, ${maxQty})">
            <div class="small text-muted mt-1">T·ªëi ƒëa: ${maxQty}</div>
          </td>
          <td>${fmtVND(itemTotal)}</td>
          <td><button class="btn btn-danger btn-sm" onclick="removeItem(${idx})">X√≥a</button></td>
        </tr>`;
    });
    document.getElementById("cartTotal").innerText = fmtVND(total);
  }

  function updateQuantity(index, qty, maxQty){
    let cart = getCart();
    qty = parseInt(qty || 1);
    if (qty > maxQty) { alert("V∆∞·ª£t qu√° t·ªìn cho ph√©p!"); qty = maxQty; }
    if (qty < 1) qty = 1;
    cart[index].quantity = qty;
    saveCart(cart);
    renderCart();
  }

  function removeItem(index){
    let cart = getCart();
    cart.splice(index,1);
    saveCart(cart);
    renderCart();
  }

 function onCheckout(){
  const info = {
    name: document.getElementById("cName").value || (PetShop.getCurrentUser()?.name || "Kh√°ch l·∫ª"),
    phone: document.getElementById("cPhone").value || "",
    addr: document.getElementById("cAddr").value || "",
  };
  if (PetShop.isStaff() && !info.name) return alert("Nh·∫≠p t√™n kh√°ch ƒë·ªÉ t·∫°o ƒë∆°n POS.");
  if (checkoutCart(info)) window.location.href = "donhang.html";
}


  renderCart();
</script>
</body>
</html>
